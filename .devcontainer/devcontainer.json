{
	"name": "Mimir API Development Container",
	
	// Use the Dockerfile in the project root
	"dockerFile": "../Dockerfile",
	"context": "..",
	
	// Dev container configuration
	"remoteUser": "mimir",
	"workspaceFolder": "/workspaces/mimir-api",
	
	// Mounts for persistent data
	"mounts": [
		"source=mimir-chromadb-data,target=/workspaces/mimir-api/data/chromadb,type=volume",
		"source=mimir-logs-data,target=/workspaces/mimir-api/data/logs,type=volume",
		"source=mimir-uploads-data,target=/workspaces/mimir-api/data/uploads,type=volume"
	],
	
	// Features to add to the dev container
	"features": {
		"ghcr.io/devcontainers/features/common-utils:2": {
			"installZsh": true,
			"installOhMyZsh": true,
			"configureZshAsDefaultShell": true,
			"username": "mimir"
		}
	},

	// Ports to forward for development
	"forwardPorts": [8000],
	"portsAttributes": {
		"8000": {
			"label": "Mimir API",
			"onAutoForward": "notify"
		}
	},

	// Commands to run after container creation
	"postCreateCommand": "echo 'Development container ready! Configure your .env file and run: ./start.sh'",

	// VS Code customizations
	"customizations": {
		"vscode": {
			"extensions": [
				"ms-python.python",
				"ms-python.flake8",
				"ms-python.black-formatter",
				"ms-toolsai.jupyter",
				"bradlc.vscode-tailwindcss",
				"ms-vscode.vscode-json",
				"ms-python.pylint",
				"ms-python.mypy-type-checker"
			],
			"settings": {
				"python.defaultInterpreterPath": "/usr/local/bin/python",
				"python.formatting.provider": "black",
				"python.linting.enabled": true,
				"python.linting.flake8Enabled": true,
				"python.linting.pylintEnabled": true,
				"python.analysis.typeCheckingMode": "basic",
				"editor.formatOnSave": true,
				"files.autoSave": "afterDelay",
				"editor.codeActionsOnSave": {
					"source.organizeImports": "explicit"
				},
				"python.analysis.autoImportCompletions": true,
				"python.terminal.activateEnvironment": false
			}
		}
	},

	// Environment variables for development
	"remoteEnv": {
		"ENVIRONMENT": "devcontainer",
		"APP_ENV": "development",
		"PYTHONPATH": "/workspaces/mimir-api",
		"CHROMADB_LOC": "/workspaces/mimir-api/data/chromadb",
		"USER_DATA_DIR": "/workspaces/mimir-api/data",
		"UPLOAD_DIR": "/workspaces/mimir-api/data/uploads",
		"LOG_FILE": "/workspaces/mimir-api/data/logs/mimir-api.log",
		"CHROMADB_ALLOW_RESET": "true"
	}
}
